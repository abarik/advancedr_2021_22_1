---
title: "RMarkdown 1"
author: "Abari Kálmán"
date: "`r Sys.Date()`"
output:
  word_document: 
    toc: yes
    toc_depth: 2
    fig_caption: yes
    reference_docx: templates/taylor_francis_word_template_articles_2016.dotx
    df_print: kable
  pdf_document:
    toc: yes
    toc_depth: '2'
  html_document:
    toc: yes
    toc_depth: 2
    toc_float: yes
    number_sections: yes
bibliography: reference/reference.bib
csl: reference/apa-no-ampersand-hun.csl
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Óravázlat

1. Dokumentációk megbeszélése: https://abarik.github.io/statisztika/
1. A munka feltételeinek megbeszélése (az R a gyakorlatban videótutorial alapján): 
    * Alap R
    * RStudio
    * RStudio alapbeállításai
    * a projektes használat
1. Az előzó féléves anyag áttekintése: `r_parancsok.html`
1. Az `r_parancsok.html`-ből egy konkrét példa megoldása `.R` kiterjesztésű parancsállomány: *Génexpressziós adatokból adott gének kiválasztása*
1. Az `.Rmd` kiterjesztésű RMarkdown állományok megbeszélése. Fontos segítség: [RStudio Cheatsheets](https://rstudio.com/resources/cheatsheets/)
1. Az RMarkdown fejléc szerkesztése
1. Az RMarkdown szövegek szerkesztése
    * Szöveg formázása (pl. címek, félkövér, dőlt, írógép, idézet, új sor, új bekezdés, felsorolás, számozás)
    * Latex képletek (bekezdés, inline)
    * Link és kép beszúrása
    * Táblázat beszúrása
    * Lábjegyzet beszúrása
    * Irodalomjegyzék és szövegközi hivatkozások beszúrása
1. Az RMarkdown R parancsok kezelése
    * Inline R parancsok
    * R csonkok
    


# Ismétlő példa megoldása

> **Génexpressziós adatokból adott gének kiválasztása**   
Olvassuk be a `data_RNA_Seq_v2_mRNA_median_Zscores_IDC_lumA_v2.txt` állományt, amely Luminal A betegekre vonatkozó génexpressziós adatokat tartalmaz. A sorokban az egy génre vonatkozó adatok találhatók. Az első oszlopban a gén neve, a további 200 oszlopban 200 beteg adata szerepel. A megjelenő számok a génkifejeződés mértéke az egészséges normához képest. Olvassuk be a gene_list.txt állományt is, amely a számunkra érdekes gének nevét tartalmazza, és ez alaján szűrjük le a fenti adatbázist (használjuk az `%in%` relációs operátort).


# Szöveg formázása

A mindennapi életben elénk kerülő adatok a legalapvetőbb természetük alapján legalább 4 csoportba sorolhatók, *számszerű* (numerikus), *karakteres* (sztring), *logikai* (állítások igazságtartalma, igaz vagy hamis) és *dátum/idő* jellegű adatokra. A statisztika tudománya is elvégzi az adatok csoportosítását, e szerint egyrészről megkülönböztetünk *nominális*, *ordinális*, *intervallum* és *arányskálájú* változókat (az alapján, hogy mit tudunk tenni a változó értékeivel), másrészt *diszkrét* és *folytonos* változókat (az alapján, hogy hány értéke van a változónak). Az adatok jellegének harmadik megközelítését adják az adott statisztikai programcsomag adattípusai, az R-ben például számunkra a legfontosabbak a **double**, **integer**, **karakteres**, **logikai**, **faktor**, **dátum** és **dátum-idő**. Az R nyelv adattípusait és kapcsolatukat a statisztikai változókategóriákkal és a mindennapi életben használt természetes felosztással a lenti táblázat tartalmazza.  
Az R adattípusokat az 1. oszlop listázza. Az `str()` és `glimpse()` függvényben az adattípus jelölésére használt rövidítések a 2. oszlopban találhatók. A statisztikai skálák és az R adattípusok lehetséges összerendelésit a 3. oszlop mutatja. E szerint **egy adatbázisban többnyire double, integer vagy faktor oszlopokat várunk**. A statisztikai változók számossága és az R adattípus közötti összefüggés a 4. oszlopban olvasható. Az utolsó oszlopban az adott adattípus mindennapi életben használatos természetét emeltük ki[^1].

A táblázat a `r getRversion()` R verzió alapján készült.



# Táblázat beszúrása

Table: Az R adattípusainak jellemzése. 

R adattípus  | `str()`, `glimpse()` | Skála                       | Számosság             | Természet
-------------|----------------------|-----------------------------|-----------------------|-----------
double       | `num`, `dbl`         | intervallum/arány           | folytonos/diszkrét    | Numerikus
integer      | `int`, `int`         | ordinális/intervallum/arány | diszkrét              | Numerikus  
karakteres   | `chr`, `chr`         | -                           | -                     | Karakteres
logikai      | `logi`, `lgl`        | -                           | -                     | Logikai
faktor       | `Factor`, `fct`      | nominális/ordinális         | diszkrét (kategorikus)| Karakteres
dátum        | `Date`, `date`       | -                           | -                     | Dátum/idő 
dátum és idő | `POSIXct`,  `dttm`   | -                           | -                     | Dátum/idő  


```{r}
knitr::kable(
  iris[1:10, ], longtable = TRUE, booktabs = TRUE,
  caption = 'A table generated by the longtable package.'
)
```


# Képek beszúrása

![Az R kényelmes használata](image/alapr-rstudio-01.png)

```{r echo=FALSE, out.width='70%', fig.align='center', fig.cap="Az R kényelmes használata"}
knitr::include_graphics(path = "image/alapr-rstudio-01.png", )
```

```{r echo=FALSE, out.width='40%', fig.align='center', fig.cap="Az R kényelmes használata"}
knitr::include_graphics(path = "image/alapr-rstudio-01.png", )
```


```{r echo=FALSE, out.width='90%', fig.cap="Az Alap R", fig.align='right'}
knitr::include_graphics(path = "image/alapr-02.jpg")
```



```{r echo=FALSE, out.width='70%', fig.align='center', fig.cap="A konzolok"}
knitr::include_graphics(path = "image/konzolok.png")
```


```{r echo=FALSE, out.width='90%', fig.align='center', fig.cap="Az R használati módjai"}
knitr::include_graphics(path = "image/hasznalati_modok.jpg")
```



```{r echo=FALSE, out.width='100%', fig.align='center', fig.cap="Az RMarkdown működése"}
knitr::include_graphics(path = "image/rmarkdown.png")
```




```{r}
smoc2_rawcounts <- read.csv("data/fibrosis_smoc2_rawcounts_unordered.csv") 
rownames(smoc2_rawcounts) <- smoc2_rawcounts$X
smoc2_rawcounts$X <- NULL

# Explore the first six observations of smoc2_rawcounts
head(smoc2_rawcounts)

# Explore the structure of smoc2_rawcounts
str(smoc2_rawcounts)
```

# R csonkok

```{r}
library(ggplot2)
ggplot(smoc2_rawcounts) + 
  geom_histogram(aes(x=smoc2_fibrosis1), bins = 300)
summary(smoc2_rawcounts$smoc2_fibrosis1)
```

# Képletek beszúrása

Diszperziós formula: $Var=\mu+\alpha\times\mu^2$

- $Var$: variancia
- $\mu$: átlag
- $\alpha$: diszperzió


A negatív binomiális modell:

$$K_{ij} \sim NB(\mu_{ij},\alpha_i)$$
$$\mu_{ij}=s_{j}q_{ij}$$


$$log_2(q_{ij})=x_j\beta_j$$


- $K_{ij}$ - nyers count az i. génben a j. mintában
- $s_{ij}$ - size factor
- $g_{ij}$ - normalizált count


A mintaátlag kiszámítása: $\bar{x}=\frac{\sum_{i=1}^{n}x_i}{n}$

A minta szórása: $$s^*=\sqrt{\frac{\sum_{i=n}^{n}(x_i-\bar{x})^2}{n-1}}$$



# Hivatkozásra példák

A lenti workflow [@Pipperrana] alapján készült. Az elemzéshez a **DESeq2** csomagot használtuk [@Love2014] és figyelembe vettük @anrlove2020 [leírását](https://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html) is. 

A workflow-ban használt kutatási kérdések és adatbázisok a @Gerarduzzi2017 publikációján alapulnak, az RNS-szekvenálási adatok a Gene Expression Omnibus (GEO) adatbázisból  letölthetők (GEO accession: [GSE85209](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE85209)).

A szövegközi hivatkozás esetei:

* [@Love2014]
* @Love2014
* [-@Love2014]
* [@Love2014;  @Gerarduzzi2017]
* @Love2014 [p. 33] 
* [@Love2014, pp. 33-35; @Gerarduzzi2017, ch. 1]

# Irodalomjegyzék



[^1]: Természetesen más felosztás is elképezhető. 
